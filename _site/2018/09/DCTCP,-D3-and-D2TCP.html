<!DOCTYPE html>
<html lang="en-us">

<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <link rel="stylesheet" href="/assets/css/normalize.css"/>
  <link rel="stylesheet" href="/assets/css/bulma.css"/>
  <link rel="stylesheet" href="/assets/css/custom.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto" rel="stylesheet"> -->

  <!-- Icons -->
  <link rel="shortcut icon" href="/assets/images/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <title>
    
      Datacenter TCP, Deadline Driven Delivery and Deadline-aware Datacenter TCP &middot; Columba M71's Blog
    
  </title>

</head>


<body>

<section class="hero is-dark">
  <div class="hero-body">
    <div class="container">
        <h1 class="title">
          <span class="typewrite" data-period="2000" data-type='[ "Columba M71"]'>
            <span class="wrap"></span>
          </span>
        </h1>
      <h4 class="subtitle" id="quote">
      </h4>
    </div>
  </div>
</section>

<div class="main-container">
  <div class="tile is-ancestor is-vertical">


    <nav class="nav has-shadow">

      <div class="nav-left">

        <a href="/" class="nav-item">
          <span class="icon">
            <i class="fa fa-home" aria-hidden="true" title="Homepage"></i>
          </span>
        </a>

        <a href="https://github.com/hnu2013wwj" class="nav-item">
          <span class="icon">
            <i class="fa fa-github" aria-hidden="true" title="Github"></i>
          </span>
        </a>

        <div class="nav-item" id="searchFieldNav">
          <div class="field has-addons">
            <p class="control">
              <input class="input is-small" type="text" placeholder="Find an article" id="search-text">
            </p>
            <p class="control">
              <a class="button is-dark is-small" onclick="searchHandler();">
                Search
              </a>
            </p>
          </div>
        </div>

      </div>

      <div class="nav-right nav-menu" id='nav-menu'>
        <a href="/archive" class="nav-item">Archive</a>
        <a href="/tags" class="nav-item">Tags</a>
      </div>

      <span class="nav-toggle" id="nav-toggle">
          <span></span>
          <span></span>
          <span></span>
    </nav>

    <div class="tile is-parent">
      <div class="tile is-8 is-child main">

        <div class="box">
    <h1 class="post-title">Datacenter TCP, Deadline Driven Delivery and Deadline-aware Datacenter TCP</h1>
    <hr/>
    <div class="content"><span class="post-text"><h2 id="datacenter-tcp-deadline-driven-delivery-and-deadline-aware-datacenter-tcp">Datacenter TCP, Deadline Driven Delivery and Deadline-aware Datacenter TCP</h2>

<h3 id="0x00-引言">0x00 引言</h3>

<p>这篇总结包含了3篇Paper的内容，一篇是SIGCOMM 2010上的DCTCP，一篇是SIGCOMM 2011上的Deadline Driven Delivery，还有一篇是SIGCOMM 2012上面的D2TCP。前者将的是如何利用<strong>Explicit Congestion Notification</strong> (<strong>ECN</strong>)解决数据中心网络中TCP的一些问题，第二个是如何加入deadline的优化，后者是前2者的优化。</p>

<p>这里只是简单地介绍。</p>

<h3 id="0x01-ecn">0x01 ECN</h3>

<p>ECN就是显示的拥塞通知。对于IPv4，它使用了DiffServ字段最右边的两个bits来标示(在一些早一点的书上，可以发现说这里是预留给以后的功能的，目前没有使用，当然现在是已经使用了)，在IPv6上Traffic Class字段的最后两个bits。</p>

<p><img src="/assets/img/dctcp-header.png" alt="dctcp-header" /></p>

<p>​    这里只给出了IPv4的header，图片来源于维基百科。</p>

<ul>
  <li><code class="highlighter-rouge">00</code> – 不支持ECN；</li>
  <li><code class="highlighter-rouge">10</code> – 支持ECN；</li>
  <li><code class="highlighter-rouge">01</code> – 支持ECN，和上面相同；</li>
  <li><code class="highlighter-rouge">11</code> –遇到了阻塞；</li>
</ul>

<p>ECN还有更多的细节，可参考相关资料。</p>

<p>.</p>

<h3 id="0x02-问题">0x02 问题</h3>

<ol>
  <li>incast 问题，在Partition/Aggregate模式中比较常见，服务器同时回复请求端导致某个地方的包突然大量增加，从而导致丢包；</li>
  <li>排队问题，长时间的流和短时间的流同时使用一个交换机端口时，导致排队，也导致短时间的数据被drop，及时没有被drop页导致了延时的增加；</li>
  <li>buffer的问题，不同的流使用不同的交换机短空，长时间的流占用了共享的buffer。</li>
</ol>

<p><img src="/assets/img/dctcp-problems.png" alt="dctcp-problems" /></p>

<h3 id="0x03-dctcp">0x03 DCTCP</h3>

<p>DCTCP利用了ECN。在交换机上，当一个端口的包超过一定的阈值之后，给包加上ECN标志。包的接受这在接受到这些包之后，将这些信息回复给发送者。发送者根据收到的包里面的ECN的情况来调整发送行为。这样就可以在发生拥塞之前就调整行为。总结一下就是3个部分:</p>

<ol>
  <li>Simple Marking at the Switch；</li>
  <li>ECN-Echo at the Receiver；</li>
  <li>ControllerattheSender；</li>
</ol>

<p>发送方记录收到的回复包里面比例，使用这样一个函数更新：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>α ← (1 − g) × α + g × F
</code></pre></div></div>

<p>F为最新窗口里面被标记的笔记，g时一个0到1之间的比例值，这个和RTT的时间估计类似。</p>

<p>然后使用:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cwnd ← cwnd × (1 − α/2)
</code></pre></div></div>

<p>来更新cwnd。</p>

<p>.</p>

<p>效果的部分数据:</p>

<p><img src="/assets/img/dctcp-results.png" alt="dctcp-results" /></p>

<h3 id="0x04-deadline-driven-delivery">0x04 Deadline Driven Delivery</h3>

<p>D3的出现时为了解决DCTCP中的deadline的问题，使用的时带宽分配的方式。每一个RTT内，发送方都计算需要在deadline之前发送完数据的带宽，然后把这个信息放进包里面。交换机在收到了这样的信息之后，使用贪婪的方式分配带宽：</p>

<p>对于有deadline的流，就在平均共享的带宽上加上发送方需要的带宽的值，没有，则就选择平均分配的带宽:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>• For a deadline flow with desired rate r, a = (r+fs), where fs is the fair share of the spare capacity after satisfying deadline flow requests.
• For a non-deadline flow, a = fs.
</code></pre></div></div>

<p>这里的具体操作还有更多的细节:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The rate allocation description above assumes the router has the rate requests for all flows at the same point in time. In reality, the router needs to make allocation decisions in an online, dynamic setting, i.e., rate requests are spread over time, and flows start and finish. To achieve this, the rate allocation operates in a slotted fashion (from the perspective of the endhosts). 
</code></pre></div></div>

<p>结果的部分数据：</p>

<p><img src="/assets/img/dctcp-d3-results.png" alt="dctcp-d3-results" /></p>

<h3 id="0x05-d2tcp">0x05 D2TCP</h3>

<p>DCTCP也是为了解决DCTCP中不可值的deadline时间改进的，同时解决D3种存在的问题。它处理考虑到拥塞的情况性外，还考虑了包的deadline信息，到达了以下的效果：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>• reduces the fraction of missed deadlines compared to DCTCP and D3 by 75% and 50%, respectively;
• achieves nearly as high bandwidth as TCP for background flows without degrading OLDI performance;
• meets3deadlines that are 35-55% tighter than those achieved by D for a reasonable 5% of missed deadlines, giving OLDIs more time for actual computation; and
• coexists with TCP flows without degrading their performance.
</code></pre></div></div>

<p>D2TCP的Congestion Avoidance算法，首先同样时DCTCP中的一个公式:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>α = (1 − g) × α + g × f
</code></pre></div></div>

<p>然后定义一个参数d，代表了deadline的紧迫程度，这里的d越大代表越紧迫，然后计算一个参数p(就是penalty的意思)：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p = a ^ d
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This function was originally proposed for color correction in graphics, and was dubbed gamma-correction because the original paper uses γ as the exponent. Note that being a fraction, 𝛼 ≤ 1 and therefore, 𝑝 ≤ 1. 
</code></pre></div></div>

<p>然后就计算新的窗口大小:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>w = w * (1 - p/2) if p &gt; 0,
  = w + 1, if p = 0
</code></pre></div></div>

<p>这里可以看出来，如果没有被标记的包，a = 0，这样p就是0，行为和正常TCP的行为一样，如果a = 1，那么计算处理啊的w就是正常情况下的一半。具体的d如何处理可参加论文。</p>

<p>Famma-correction函数的示意图:</p>

<p><img src="/assets/img/dctcp-correction.png" alt="dctcp-correction" /></p>

<p>具体分析这里省略了。结果的部分数据:</p>

<p><img src="/assets/img/d2tcp-results.png" alt="d2tcp-results" /></p>

<p>.</p>

<h2 id="参考">参考</h2>

<ol>
  <li>Data Center TCP (DCTCP), SIGCOMM 2010.</li>
  <li>Deadline-Aware Datacenter TCP (D2TCP), SIGCOMM 2012.</li>
  <li>Better Never than Late: Meeting Deadlines in Datacenter Networks, SIGCOMM 2011.</li>
  <li>https://en.wikipedia.org/wiki/Explicit_Congestion_Notification, Explicit Congestion Notification (ECN).</li>
</ol>
</span></div>
</div>


      </div>

      <div class="tile is-4 is-child">
        <div class="tile is-parent is-vertical sidebar">

          <div class="tile is-child widget">

            <div class="card">
              <header class="card-header">
                <p class="card-header-title nice-title">
                  Recent Posts
                </p>
              </header>
              <div class="card-content">
                <div class="content nice-text">
                  <ul>
                  
                  <li><a href="/2018/10/LegoOS.html">
                    LegoOS -- A Disseminated, Distributed OS for Hardware Resource Disaggregation
                  </a></li>
                  
                  <li><a href="/2018/10/Level-Hashing.html">
                    Write-Optimized and High-Performance Hashing Index Scheme for Persistent Memory
                  </a></li>
                  
                  <li><a href="/2018/10/Classical-Papers.html">
                    计算机科学经典论文
                  </a></li>
                  
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div class="tile is-child widget">

            <div class="card">
              <header class="card-header">
                <p class="card-header-title nice-title">
                  Sponsored
                </p>
              </header>
              <div class="card-content">
                <div class="content nice-text">
                  <img src="/assets/images/Dust_Bunny.jpg"/>
                </div>
              </div>
            </div>

          </div>

          <div class="tile is-child widget">
            <div class="card">
              <header class="card-header">
                <p class="card-header-title nice-title">
                  Recommended Websites
                </p>
              </header>
              <!-- <div class="card-content">
                <div class="content nice-text">
                  <ul>
                    <li>
                      <a href="https://xkcd.com">xkcd</a>
                    </li>
                    <li>
                      <a href="http://commitstrip.com">Commit Strip</a>
                    </li>
                    <li>
                      <a href="http://www.smbc-comics.com">SMBC Comics</a>
                    </li>
                    <li>
                      <a href="https://blog.codinghorror.com">Coding Horror</a>
                    </li>
                    <li>
                      <a href="http://waitbutwhy.com">Wait Buy Why</a>
                    </li>
                    <li>
                      <a href="https://simplysoch.wordpress.com/">Simply Soch</a>
                    </li>
                  </ul>
                </div> -->
              </div>
            </div>
          </div>

        </div>

      </div>

    </div>

  </div>
</div>

<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <p>
        Some rights reserved.
      </p>
      <p>
        Made with <i class="fa fa-heart"></i> and <a href="https://github.com/jgthms/bulma">Bulma</a>, <a href="https://jekyllrb.com/">Jekyll</a>. Hosted on <a href="https://github.com/">Github</a>
      </p>
      <p>
        <a class="icon" href="">
          <i class="fa fa-github" title="Github"></i>
        </a>
        <a class="icon" href="">
          <i class="fa fa-linkedin" title="Linkedin"></i>
        </a>
        <a class="icon" href="">
          <i class="fa fa-envelope" title="Email"></i>
        </a>
      </p>
    </div>
  </div>
</footer>

<!-- js -->
<script src="/assets/js/custom.js"></script>
<script src="/assets/js/typewriter.js"></script>
</body>
</html>
