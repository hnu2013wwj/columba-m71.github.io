<!DOCTYPE html>
<html lang="en-us">

<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <link rel="stylesheet" href="/assets/css/normalize.css"/>
  <link rel="stylesheet" href="/assets/css/bulma.css"/>
  <link rel="stylesheet" href="/assets/css/custom.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto" rel="stylesheet"> -->

  <!-- Icons -->
  <link rel="shortcut icon" href="/assets/images/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <title>
    
      Fine-grained TCP Retransmissions &middot; Columba M71's Blog
    
  </title>

</head>


<body>

<section class="hero is-dark">
  <div class="hero-body">
    <div class="container">
        <h1 class="title">
          <span class="typewrite" data-period="2000" data-type='[ "Columba M71"]'>
            <span class="wrap"></span>
          </span>
        </h1>
      <h4 class="subtitle" id="quote">
      </h4>
    </div>
  </div>
</section>

<div class="main-container">
  <div class="tile is-ancestor is-vertical">


    <nav class="nav has-shadow">

      <div class="nav-left">

        <a href="/" class="nav-item">
          <span class="icon">
            <i class="fa fa-home" aria-hidden="true" title="Homepage"></i>
          </span>
        </a>

        <a href="https://github.com/hnu2013wwj" class="nav-item">
          <span class="icon">
            <i class="fa fa-github" aria-hidden="true" title="Github"></i>
          </span>
        </a>

        <div class="nav-item" id="searchFieldNav">
          <div class="field has-addons">
            <p class="control">
              <input class="input is-small" type="text" placeholder="Find an article" id="search-text">
            </p>
            <p class="control">
              <a class="button is-dark is-small" onclick="searchHandler();">
                Search
              </a>
            </p>
          </div>
        </div>

      </div>

      <div class="nav-right nav-menu" id='nav-menu'>
        <a href="/archive" class="nav-item">Archive</a>
        <a href="/tags" class="nav-item">Tags</a>
      </div>

      <span class="nav-toggle" id="nav-toggle">
          <span></span>
          <span></span>
          <span></span>
    </nav>

    <div class="tile is-parent">
      <div class="tile is-8 is-child main">

        <div class="box">
    <h1 class="post-title">Fine-grained TCP Retransmissions</h1>
    <hr/>
    <div class="content"><span class="post-text"><h2 id="safe-and-effective-fine-grained-tcp-retransmissions-for-datacenter-communication">Safe and Effective Fine-grained TCP Retransmissions for Datacenter Communication</h2>

<h3 id="引言">引言</h3>

<p>TCP中对于超时重传的时间处理上，为了避免虚假的超时重传，设置来一个最小的超时时间。在Linux上，这个是时间一般是200ms。在广域网上，这个最低的值设置是有意义的。但是在延时很低的数据中心内部，设个时间限制就可能导致一些问题，特别是incast的情况(就是多台机器与一台机器同时通信)。</p>

<p>这篇Paper就讨论了减小这个RTO带来的影响，发现可以通过将这个RTO的最小值设置的很小也能保证安全和效率，同时解决存在的问题。</p>

<h3 id="问题分析">问题分析</h3>

<p>现在常见的RTO计算方式是:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RTO = SRTT + (4 × RTTVAR)
</code></pre></div></div>

<p>考虑到指数退让，这里就是:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>timeout = RTO × 2 ^ backoff
</code></pre></div></div>

<p>.</p>

<p>模拟中这个RTO的最小值对性能的影响，可以看出来RTO的最小值对性能有着明显的影响(模拟情况):</p>

<p><img src="/assets/img/fine-rto-simulation.png" alt="fine-rto-simulation" /></p>

<p>​	Paper中的在实际情况中的测试，也显示出减小RTOmin对性能的影响。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Despite these differences, the real world results show the need to reduce the RTO to at least 1ms to avoid throughput degradation at scales of up to 16 servers.
</code></pre></div></div>

<p>此外，除了减小RTO能带来明显的好处外，给timeout一个随机的元素也能带来良好的效果:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>timeout = (RTO + (rand(0.5) × RTO)) × 2 ^ backoff
</code></pre></div></div>

<p>模拟结果：</p>

<p><img src="/assets/img/rto-fine-rand.png" alt="rto-fine-rand" /></p>

<h3 id="实现">实现</h3>

<p>实现上主要修改的地方就是利用linux的高精度时间子系统，解决之前TCP stack中时间测量过于粗糙的问题。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>With the TCP timestamp option enabled, RTT estimates are calculated based on the difference between the timestamp option in an earlier packet and the corresponding ACK. We convert the time from nanoseconds to microseconds and store the value in the TCP timestamp option.2 This change can be accomplished entirely on the sender—receivers already echo back the value in the TCP timestamp option.
</code></pre></div></div>

<p>.</p>

<blockquote>

</blockquote>

<h3 id="安全否">安全否?</h3>

<p>其实上面减小RTOmin能带来的效果是很显然的，主要是安全问题？是否会导致大量的假的超时，从而导致重传反而降低了性能呢？Paper的观点当然是很安全啦。</p>

<p>RTO本来就有很大的随机性的元素，选择什么样的RTOmin，是一个取舍的问题。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>As a result, wide-area “packet delays [are] not mathematically [or] operationally steady”, which confirms the Allman and Paxson observation that RTO estimation involves a fundamental tradeoff between rapid retransmission and spurious retransmissions.
</code></pre></div></div>

<p>.</p>

<p>Delayed ACK确实可能对器有一些影响，但是，这个情况可以被TCP的新功能和能产生影响的有限的条件缓和。说了好大的一堆，就是说没啥影响。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>In practice, these two potential consequences are mitigated by newer TCP features and by the limited circumstances in which they occur, as we explore in the next two sections. We find that eliminating the RTOmin has little impact on bulk data transfer performance for wide- area flows, and that in the datacenter, delayed ACK causes only a small, though noticeable drop in throughput when the RTOmin is set below the delayed ACK threshold.
</code></pre></div></div>

<p>.</p>

<p>在广域网上测试的数据 ：</p>

<p><img src="/assets/img/rto-wide-erea.png" alt="rto-wide-erea" /></p>

<h2 id="参考">参考</h2>

<ol>
  <li>Safe and Effective Fine-grained TCP Retransmissions for Datacenter Communication, SIGCOMM 2009.</li>
</ol>
</span></div>
</div>


      </div>

      <div class="tile is-4 is-child">
        <div class="tile is-parent is-vertical sidebar">

          <div class="tile is-child widget">

            <div class="card">
              <header class="card-header">
                <p class="card-header-title nice-title">
                  Recent Posts
                </p>
              </header>
              <div class="card-content">
                <div class="content nice-text">
                  <ul>
                  
                  <li><a href="/2018/10/LegoOS.html">
                    LegoOS -- A Disseminated, Distributed OS for Hardware Resource Disaggregation
                  </a></li>
                  
                  <li><a href="/2018/10/Level-Hashing.html">
                    Write-Optimized and High-Performance Hashing Index Scheme for Persistent Memory
                  </a></li>
                  
                  <li><a href="/2018/10/Classical-Papers.html">
                    计算机科学经典论文
                  </a></li>
                  
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div class="tile is-child widget">

            <div class="card">
              <header class="card-header">
                <p class="card-header-title nice-title">
                  Sponsored
                </p>
              </header>
              <div class="card-content">
                <div class="content nice-text">
                  <img src="/assets/images/Dust_Bunny.jpg"/>
                </div>
              </div>
            </div>

          </div>

          <div class="tile is-child widget">
            <div class="card">
              <header class="card-header">
                <p class="card-header-title nice-title">
                  Recommended Websites
                </p>
              </header>
              <!-- <div class="card-content">
                <div class="content nice-text">
                  <ul>
                    <li>
                      <a href="https://xkcd.com">xkcd</a>
                    </li>
                    <li>
                      <a href="http://commitstrip.com">Commit Strip</a>
                    </li>
                    <li>
                      <a href="http://www.smbc-comics.com">SMBC Comics</a>
                    </li>
                    <li>
                      <a href="https://blog.codinghorror.com">Coding Horror</a>
                    </li>
                    <li>
                      <a href="http://waitbutwhy.com">Wait Buy Why</a>
                    </li>
                    <li>
                      <a href="https://simplysoch.wordpress.com/">Simply Soch</a>
                    </li>
                  </ul>
                </div> -->
              </div>
            </div>
          </div>

        </div>

      </div>

    </div>

  </div>
</div>

<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <p>
        Some rights reserved.
      </p>
      <p>
        Made with <i class="fa fa-heart"></i> and <a href="https://github.com/jgthms/bulma">Bulma</a>, <a href="https://jekyllrb.com/">Jekyll</a>. Hosted on <a href="https://github.com/">Github</a>
      </p>
      <p>
        <a class="icon" href="">
          <i class="fa fa-github" title="Github"></i>
        </a>
        <a class="icon" href="">
          <i class="fa fa-linkedin" title="Linkedin"></i>
        </a>
        <a class="icon" href="">
          <i class="fa fa-envelope" title="Email"></i>
        </a>
      </p>
    </div>
  </div>
</footer>

<!-- js -->
<script src="/assets/js/custom.js"></script>
<script src="/assets/js/typewriter.js"></script>
</body>
</html>
